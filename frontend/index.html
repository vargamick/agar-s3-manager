<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Agar Processor</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Application CSS -->
    <link rel="stylesheet" href="./assets/css/styles.css?v=2.1.1">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-cogs"></i> Ask Agar Processor</h1>
                <p>Document management and data processing pipeline</p>
            </div>
            <div class="header-actions">
                <span id="connectionStatus" class="connection-status">
                    <i class="fas fa-circle"></i> Checking...
                </span>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-navigation">
            <button type="button" class="tab-btn active" data-tab="documents" onclick="switchTab('documents')">
                <i class="fas fa-folder"></i> Documents
            </button>
            <button type="button" class="tab-btn" data-tab="admin" onclick="switchTab('admin')">
                <i class="fas fa-server"></i> Admin
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Document Manager Panel -->
            <div id="documentsTab" class="tab-content active">
            <div class="document-manager-panel">
                <div class="panel-header">
                    <div class="header-left">
                        <i class="fas fa-folder"></i> S3 Document Management
                    </div>
                </div>

                <!-- Document Library Layout -->
                <div class="library-layout">
                    <!-- Left Panel: Folder Tree (25%) -->
                    <div class="folder-panel">
                        <div class="folder-header">
                            <h4><i class="fas fa-sitemap"></i> Folder Structure</h4>
                            <button class="btn btn-small btn-icon" onclick="refreshFolderTree()" title="Refresh">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="folder-tree" id="folderTree">
                            <div class="status-info">Loading folder structure...</div>
                        </div>
                        <div class="folder-actions">
                            <button class="icon-btn" onclick="createFolderPrompt()" title="New Folder">
                                <i class="fas fa-folder-plus"></i>
                            </button>
                            <input type="file" id="folderUploadInput" webkitdirectory multiple style="display: none;">
                            <button class="icon-btn" onclick="document.getElementById('folderUploadInput').click()" title="Upload Folder">
                                <i class="fas fa-folder-open"></i>
                            </button>
                            <button class="icon-btn delete-btn" onclick="deleteCurrentFolder()" title="Delete Folder">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Main Panel: File List (75%) -->
                    <div class="file-panel">
                        <!-- Breadcrumb Navigation -->
                        <div class="breadcrumb-nav" id="breadcrumbNav">
                            <span class="breadcrumb-item" onclick="navigateToFolder('')">
                                <i class="fas fa-home"></i> Root
                            </span>
                        </div>

                        <div class="file-toolbar">
                            <div class="file-info">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                    <span class="checkmark"></span>
                                    Select All
                                </label>
                                <span id="fileCount">0 files</span>
                                <span id="selectionCount">0 selected</span>
                            </div>
                            <div class="search-controls">
                                <input type="text" id="fileSearch" placeholder="Search files..." onkeyup="filterFiles()">
                            </div>
                        </div>

                        <div class="file-list-container" id="fileListContainer">
                            <div class="status-info">Select a folder to view files</div>
                        </div>

                        <div class="pagination-controls" id="paginationControls" style="display: none;">
                            <button class="btn btn-small" id="prevPageBtn" onclick="previousPage()" disabled>
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                            <span id="pageInfo">Page 1 of 1</span>
                            <button class="btn btn-small" id="nextPageBtn" onclick="nextPage()" disabled>
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>

                        <!-- File Action Buttons -->
                        <div class="file-actions">
                            <input type="file" id="fileUploadInput" multiple style="display: none;">
                            <button class="icon-btn" onclick="document.getElementById('fileUploadInput').click()" title="Add Files">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="icon-btn" onclick="downloadSelectedFiles()" title="Download Selected">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="icon-btn" onclick="moveSelectedFiles()" title="Move Selected Files">
                                <i class="fas fa-arrows-alt"></i>
                            </button>
                            <button class="icon-btn delete-btn" onclick="deleteSelectedFiles()" title="Delete Selected">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Upload Progress -->
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-info">
                        <span id="uploadFileName">Uploading...</span>
                        <span id="uploadProgressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="uploadProgressFill"></div>
                    </div>
                </div>

                <!-- Status Display -->
                <div id="statusMessage" class="status-indicator" style="display: none;"></div>
            </div>
            </div> <!-- End documentsTab -->

            <!-- Admin Tab -->
            <div id="adminTab" class="tab-content">
                <div class="admin-panel">
                    <!-- Admin Header -->
                    <div class="panel-header">
                        <div class="header-left">
                            <i class="fas fa-server"></i> Database Administration
                        </div>
                        <div class="header-right">
                            <span id="adminApiStatus" class="api-status">
                                <i class="fas fa-circle"></i> Checking API...
                            </span>
                        </div>
                    </div>

                    <!-- Admin Content -->
                    <div class="admin-content">
                        <!-- System Status -->
                        <div class="admin-section">
                            <div class="section-header">
                                <h3><i class="fas fa-heartbeat"></i> System Status</h3>
                                <button class="btn btn-small btn-icon" onclick="refreshAdminStatus()" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="status-grid" id="adminStatusGrid">
                                <div class="status-card">
                                    <div class="status-icon neo4j">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="status-info">
                                        <span class="status-label">Neo4j</span>
                                        <span class="status-value" id="neo4jStatus">--</span>
                                    </div>
                                </div>
                                <div class="status-card">
                                    <div class="status-icon postgres">
                                        <i class="fas fa-database"></i>
                                    </div>
                                    <div class="status-info">
                                        <span class="status-label">PostgreSQL</span>
                                        <span class="status-value" id="postgresStatus">--</span>
                                    </div>
                                </div>
                                <div class="status-card">
                                    <div class="status-icon s3">
                                        <i class="fas fa-cloud"></i>
                                    </div>
                                    <div class="status-info">
                                        <span class="status-label">S3</span>
                                        <span class="status-value" id="s3Status">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Database Stats -->
                        <div class="admin-section">
                            <h3><i class="fas fa-chart-bar"></i> Database Statistics</h3>
                            <div class="stats-grid" id="adminStatsGrid">
                                <div class="stat-card">
                                    <span class="stat-value" id="statEntities">--</span>
                                    <span class="stat-label">Entities</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-value" id="statRelationships">--</span>
                                    <span class="stat-label">Relationships</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-value" id="statEmbeddings">--</span>
                                    <span class="stat-label">Embeddings</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-value" id="statLabels">--</span>
                                    <span class="stat-label">Labels</span>
                                </div>
                            </div>
                        </div>

                        <!-- Current Job Status -->
                        <div class="admin-section" id="currentJobSection" style="display: none;">
                            <div class="section-header">
                                <h3><i class="fas fa-tasks"></i> Current Job</h3>
                                <button class="btn btn-small btn-danger" id="cancelJobBtn" onclick="cancelCurrentJob()">
                                    <i class="fas fa-stop"></i> Cancel
                                </button>
                            </div>
                            <div class="job-status-card">
                                <div class="job-status-header">
                                    <span class="job-phase-badge" id="jobPhaseBadge">--</span>
                                    <span class="job-message" id="jobMessage">--</span>
                                    <div class="spinner" id="jobSpinner"></div>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="jobProgressFill" style="width: 0%"></div>
                                </div>
                                <div class="job-details">
                                    <span>Job ID: <code id="jobId">--</code></span>
                                    <span>Started: <span id="jobStarted">--</span></span>
                                </div>
                                <div class="job-error" id="jobError" style="display: none;"></div>
                                <div class="job-results" id="jobResults" style="display: none;">
                                    <h5>Results</h5>
                                    <ul id="jobResultsList"></ul>
                                </div>
                            </div>
                        </div>

                        <!-- Scrape Runs -->
                        <div class="admin-section">
                            <h3><i class="fas fa-database"></i> Available Scrape Runs</h3>
                            <div class="scrape-runs-list" id="scrapeRunsList">
                                <div class="status-info"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
                            </div>
                        </div>

                        <!-- Refresh Action -->
                        <div class="admin-section">
                            <h3><i class="fas fa-sync"></i> Start Refresh</h3>
                            <div class="action-card">
                                <p class="action-description" id="refreshDescription">
                                    No scrape run selected. Will use most recent FULL run.
                                </p>
                                <button class="btn btn-primary btn-large" id="startRefreshBtn" onclick="startRefresh()">
                                    <i class="fas fa-play"></i> Start Refresh from S3
                                </button>
                            </div>
                        </div>

                        <!-- Database Reset -->
                        <div class="admin-section danger-section">
                            <h3><i class="fas fa-exclamation-triangle"></i> Database Reset</h3>
                            <div class="reset-preview" id="resetPreview">
                                <p class="warning-text">Loading reset preview...</p>
                            </div>
                            <div class="action-card">
                                <button class="btn btn-danger" id="resetDbBtn" onclick="showResetConfirm()">
                                    <i class="fas fa-trash-alt"></i> Reset Databases
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Status Display -->
                    <div id="adminStatusMessage" class="status-indicator" style="display: none;"></div>
                </div>
            </div> <!-- End adminTab -->
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Ask Agar Processor <span id="appVersion">v2.0.0</span> &copy; 2024 | Powered by Ask Agar</p>
        </footer>
    </div>

    <!-- Ask Agar Chat Interface -->
    <div id="header-search" class="container p-5"></div>
    <script src="https://d1bf5c4zvnlohu.cloudfront.net/development/addChatInterface.js"></script>

    <!-- Move Files Modal -->
    <div id="moveFilesModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-arrows-alt"></i> Move Selected Files</h3>
                <span class="close" onclick="closeMoveModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="move-files-info">
                    <p><strong>Moving <span id="moveFileCount">0</span> selected file(s)</strong></p>
                    <p><small>Select a destination folder:</small></p>
                </div>

                <div class="form-group">
                    <label>Destination Folder:</label>
                    <div class="folder-selector">
                        <div class="folder-tree-container" id="moveFolderTree">
                            <div class="status-info">Loading folders...</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Or create a new folder:</label>
                    <div class="input-group">
                        <input type="text" id="newMoveFolder" class="form-control" placeholder="Enter new folder name...">
                        <button class="btn btn-secondary" onclick="createFolderForMove()">Create</button>
                    </div>
                </div>

                <div class="selected-destination" id="selectedDestination" style="display: none;">
                    <p><strong>Selected destination:</strong> <span id="destinationPath"></span></p>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-success" onclick="confirmMoveFiles()" id="moveBtn" disabled>
                        <i class="fas fa-check"></i> Move Files
                    </button>
                    <button class="btn btn-secondary" onclick="closeMoveModal()">Cancel</button>
                </div>

                <div class="processing-status" id="moveProcessingStatus" style="display: none;">
                    <div class="spinner"></div>
                    <div class="status-text">Moving files...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="resetConfirmModal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header danger">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirm Database Reset</h3>
                <span class="close" onclick="closeResetModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-box">
                    <p><strong>This action cannot be undone!</strong></p>
                    <p>A backup will be created automatically before reset.</p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-danger" onclick="confirmReset()">
                        <i class="fas fa-trash-alt"></i> Yes, Reset Everything
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeResetModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div id="createFolderModal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3><i class="fas fa-folder-plus"></i> Create New Folder</h3>
                <span class="close" onclick="closeCreateFolderModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newFolderName">Folder Name:</label>
                    <input type="text" id="newFolderName" class="form-control" placeholder="Enter folder name...">
                    <small class="form-text">Will be created in: <span id="createFolderPath">/</span></small>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-success" onclick="confirmCreateFolder()">
                        <i class="fas fa-check"></i> Create
                    </button>
                    <button class="btn btn-secondary" onclick="closeCreateFolderModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./assets/js/app.js?v=2.1.0"></script>
</body>
</html>
